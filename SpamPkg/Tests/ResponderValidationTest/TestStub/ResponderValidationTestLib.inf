## @file
# This library register a supervisor level handler to test SPAM responder functionalities.
#
# Copyright (C) Microsoft Corporation.
#
# SPDX-License-Identifier: BSD-2-Clause-Patent
#
##

[Defines]
  INF_VERSION                    = 0x0001001A
  BASE_NAME                      = ResponderValidationTestLib
  FILE_GUID                      = 4E4C89DC-A452-4B6B-B183-F16A2A223733
  MODULE_TYPE                    = MM_CORE_STANDALONE
  VERSION_STRING                 = 1.0
  PI_SPECIFICATION_VERSION       = 0x00010032
  LIBRARY_CLASS                  = ResponderValidationTestLib|MM_CORE_STANDALONE
  CONSTRUCTOR                    = ResponderValidationTestLibConstructor

[Sources]
  ResponderValidationTestLib.c

[Packages]
  MdePkg/MdePkg.dec
  MdeModulePkg/MdeModulePkg.dec
  StandaloneMmPkg/StandaloneMmPkg.dec
  UefiCpuPkg/UefiCpuPkg.dec
  MmSupervisorPkg/MmSupervisorPkg.dec
  SpamPkg/SpamPkg.dec

[LibraryClasses]
  BaseLib
  BaseMemoryLib
  CacheMaintenanceLib
  DebugLib
  ExtractGuidedSectionLib
  FvLib
  HobLib
  MemoryAllocationLib
  MemLib
  PeCoffLib
  ReportStatusCodeLib
  StandaloneMmCoreEntryPoint
  MtrrLib
  LocalApicLib
  SynchronizationLib
  SmmCpuFeaturesLib
  DebugAgentLib
  SmmCpuPlatformHookLib
  CpuExceptionHandlerLib
  DevicePathLib
  CcExitLib
  SortLib
  HwResetSystemLib
  SmmPolicyGateLib
  MmMemoryProtectionHobLib ## MU_CHANGE
  IhvSmmSaveStateSupervisionLib
  SafeIntLib
  TimerLib
  PerformanceLib
  CpuPageTableLib
  MmSaveStateLib
  SmmCpuSyncLib
  SecurePolicyLib

[Protocols]
  gEfiMmEndOfDxeProtocolGuid                   ## PRODUCES
  gEfiLoadedImageProtocolGuid                   ## PRODUCES
  gEfiMmConfigurationProtocolGuid               ## CONSUMES

  gEfiSmmReadyToLockProtocolGuid
  gEfiSmmConfigurationProtocolGuid
  gSmmExceptionTestProtocolGuid            ## PRODUCES ## MS_CHANGE

  gEfiSmmSwDispatch2ProtocolGuid                ## SOMETIMES_CONSUMES
  gEfiSmmSxDispatch2ProtocolGuid                ## SOMETIMES_CONSUMES
  gEfiSmmPowerButtonDispatch2ProtocolGuid       ## SOMETIMES_CONSUMES
  gEfiSmmStandbyButtonDispatch2ProtocolGuid     ## SOMETIMES_CONSUMES
  gEfiSmmPeriodicTimerDispatch2ProtocolGuid     ## SOMETIMES_CONSUMES
  gEfiSmmGpiDispatch2ProtocolGuid               ## SOMETIMES_CONSUMES
  gEfiSmmIoTrapDispatch2ProtocolGuid            ## SOMETIMES_CONSUMES
  gEfiSmmUsbDispatch2ProtocolGuid               ## SOMETIMES_CONSUMES
  gEdkiiSmmMemoryAttributeProtocolGuid          ## CONSUMES
  gEfiSmmSxDispatch2ProtocolGuid                ## SOMETIMES_CONSUMES
  gEfiDxeMmReadyToLockProtocolGuid              ## CONSUMES

[FeaturePcd]
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmDebug                         ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmBlockStartupThisAp            ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmEnableBspElection             ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuHotPlugSupport                   ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmStackGuard                    ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmProfileEnable                 ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmFeatureControlMsrLock         ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdSmmApPerfLogEnable                  ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdSmmExceptionTestModeSupport         ## CONSUMES ## MS_CHANGE
  gMmSupervisorPkgTokenSpaceGuid.PcdMmSupervisorTestEnable         ## CONSUMES
  gMmSupervisorPkgTokenSpaceGuid.PcdMmSupervisorPrintPortsEnable   ## CONSUMES
  gMmSupervisorPkgTokenSpaceGuid.PcdEnableSyscallLogs              ## CONSUMES

[FixedPcd]
  gUefiCpuPkgTokenSpaceGuid.PcdCpuMaxLogicalProcessorNumber        ## SOMETIMES_CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmProfileSize                   ## SOMETIMES_CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmStackSize                     ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmCodeAccessCheckEnable         ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmSyncMode                      ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmApSyncTimeout                 ## CONSUMES
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmShadowStackSize               ## SOMETIMES_CONSUMES
  gEfiMdePkgTokenSpaceGuid.PcdControlFlowEnforcementPropertyMask        ## CONSUMES
  # MU_CHANGE START Remove memory protection PCD references
  # gEfiMdeModulePkgTokenSpaceGuid.PcdHeapGuardPageType                   ## CONSUMES
  # gEfiMdeModulePkgTokenSpaceGuid.PcdHeapGuardPoolType                   ## CONSUMES
  # gEfiMdeModulePkgTokenSpaceGuid.PcdHeapGuardPropertyMask               ## CONSUMES
  # gEfiMdeModulePkgTokenSpaceGuid.PcdNullPointerDetectionPropertyMask    ## CONSUMES
  # MU_CHANGE END
  gUefiCpuPkgTokenSpaceGuid.PcdSmmExceptionRebootInsteadOfHaltDefault   ## CONSUMES ## MS_CHANGE
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmMpTokenCountPerChunk               ## CONSUMES
  gEfiMdeModulePkgTokenSpaceGuid.PcdSmiHandlerProfilePropertyMask       ## CONSUMES
  gMmSupervisorPkgTokenSpaceGuid.PcdMmSupervisorPrintPortsMaxSize       ## CONSUMES
  gMmSupervisorPkgTokenSpaceGuid.PcdMmSupervisorExceptionStackSize      ## CONSUMES

[FixedPcd.X64]
  gUefiCpuPkgTokenSpaceGuid.PcdCpuSmmRestrictedMemoryAccess        ## CONSUMES

[Guids]
  gAprioriGuid                                  ## SOMETIMES_CONSUMES   ## File
  gMmSupervisorDriverDispatchGuid               ## PRODUCES             ## GUID # SmiHandlerRegister
  ## SOMETIMES_CONSUMES   ## GUID # Locate protocol
  ## SOMETIMES_PRODUCES   ## GUID # SmiHandlerRegister
  gEdkiiMemoryProfileGuid
  gZeroGuid                                     ## SOMETIMES_CONSUMES   ## GUID
  gEfiSmmSmramMemoryGuid                        ## SOMETIMES_CONSUMES   ## GUID
  gSmmBaseHobGuid                               ## CONSUMES
  gEfiHobListGuid
  gMmCoreDataHobGuid
  gMmFvDispatchGuid
  gEfiEventLegacyBootGuid

  gMmCoreMmProfileGuid
  gMmCommonRegionHobGuid                        ## CONSUMES
  gMmProtectedRegionHobGuid                     ## SOMETIMES_CONSUMES
  gMmUnblockRegionHobGuid                       ## SOMETIMES_CONSUMES

  ## SOMETIMES_PRODUCES   ## GUID # Install protocol
  ## SOMETIMES_PRODUCES   ## GUID # SmiHandlerRegister
  gSmiHandlerProfileGuid

  gMmSupervisorRequestHandlerGuid               ## SOMETIMES_CONSUMES   ## GUID # SmiHandlerRegister
  gMmSupervisorPolicyFileGuid                   ## CONSUMES
  gMmPagingAuditMmiHandlerGuid                  ## SOMETIMES_CONSUMES

[BuildOptions.common]
  #Subsystem version will be used as MmSupervisor driver version
  #Image version will be used as MmSupervisor security patch level(SPL) value
  MSFT:RELEASE_*_*_DLINK_FLAGS  = /DLL /SUBSYSTEM:CONSOLE,$(RELEASE_DRIVER_VERSION) /VERSION:$(MAJOR_PATCH_LEVEL).$(MINOR_PATCH_LEVEL)
  MSFT:DEBUG_*_*_DLINK_FLAGS    = /DLL /SUBSYSTEM:CONSOLE,$(DEBUG_DRIVER_VERSION) /VERSION:$(MAJOR_PATCH_LEVEL).$(MINOR_PATCH_LEVEL)

  GCC:RELEASE_*_*_OBJCOPY_FLAGS = --subsystem efi-bsd:$(RELEASE_DRIVER_VERSION)
  GCC:DEBUG_*_*_OBJCOPY_FLAGS   = --subsystem efi-bsd:$(DEBUG_DRIVER_VERSION)
  # GCC:*_*_*_DLINK_FLAGS         = -Wl,--major-image-version,$(MAJOR_PATCH_LEVEL),--minor-image-version,$(MINOR_PATCH_LEVEL)

  *_*_*_GENFW_FLAGS        = --keepoptionalheader

